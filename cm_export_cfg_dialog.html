<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
</head>

<body>
  <div id="input" style="display:block">
    <p>Select metadata configuration (to be used to build Metadata sheet)</p>
    <div>
      <input type="radio" id="cn" name="cfgId" value="10-24_vX.Y (Module 1-4)" title="CN" checked>
      <label for="cfg_cn">10-24_vX.Y (Module 1-4)</label><br>
      <input type="radio" id="cfg_can" name="cfgId" value="29_vX.Y (Module 6)" title="EF29">
      <label for="cfg_can">29_vX.Y (Module 6)</label><br>
      <input type="radio" id="cfg_cncan" name="cfgId" value="10-24+29_vX.Y (Module 1-6)" title="CN+EF29">
      <label for="cfg_cncan">10-24+29_vX.Y (Module 1-6)</label><br>
      <input type="radio" id="cfg_pin" name="cfgId" value="1-9_vX.Y (Module 7)" title="PIN">
      <label for="cfg_pin">1-9_vX.Y (Module 7)</label><br>
      <input type="radio" id="cfg_allnew" name="cfgId" value="1-40+CEI+T01-T02+E1-E6_vX.Y (Module 7+8)" title="All (New)">
      <label for="cfg_pin">1-40+CEI+T01-T02+E1-E6_vX.Y (Module 7+8)</label><br>
      <input type="radio" id="cfg_all" name="cfgId" value="1-40+CEI+T01-T02+E1-E6_vX.Y (All Modules)" title="All">
      <label for="cfg_pin">1-40+CEI+T01-T02+E1-E6_vX.Y (All Modules)</label><br>
    </div>

    <p>Select one or more SDKs for which the exports will be generated</p>
    <div>
      <label>
          <input type="checkbox" class="checkAll" onclick="toggleGroup(this, '.sdk')"> <i>Check all</i>
      </label>
      <br>
      <input type="checkbox" id="sdk_1_3" name="sdk" value="1.3" checked class="sdk">
      <label for="sdk_1_3">1.3</label><br>
      <input type="checkbox" id="sdk_1_4" name="sdk" value="1.4" class="sdk">
      <label for="sdk_1_4">1.4</label><br>
      <input type="checkbox" id="sdk_1_5" name="sdk" value="1.5"  class="sdk">
      <label for="sdk_1_5">1.5</label><br>
      <input type="checkbox" id="sdk_1_6" name="sdk" value="1.6"  class="sdk">
      <label for="sdk_1_6">1.6</label><br>
      <input type="checkbox" id="sdk_1_7" name="sdk" value="1.7"  class="sdk">
      <label for="sdk_1_7">1.7</label><br>
      <input type="checkbox" id="sdk_1_8" name="sdk" value="1.8"  class="sdk">
      <label for="sdk_1_8">1.8</label><br>
      <input type="checkbox" id="sdk_1_9" name="sdk" value="1.9"  class="sdk">
      <label for="sdk_1_9">1.9</label><br>
      <input type="checkbox" id="sdk_1_10" name="sdk" value="1.10"  class="sdk">
      <label for="sdk_1_10">1.10</label><br>
      <input type="checkbox" id="sdk_1_11" name="sdk" value="1.11"  class="sdk">
      <label for="sdk_1_11">1.11</label><br>
      <input type="checkbox" id="sdk_1_12" name="sdk" value="1.12"  class="sdk">
      <label for="sdk_1_12">1.12</label><br>
      <input type="checkbox" id="sdk_1_13" name="sdk" value="1.13"  class="sdk">
      <label for="sdk_1_13">1.13</label><br>
    </div>
    <p>Select one or more modules to be included in the export</p>
    <div>
      <input type="checkbox" id="module_1" name="module" value="1" checked>
      <label for="module_1">1</label><br>
      <input type="checkbox" id="module_16" name="module" value="1.6" checked>
      <label for="module_1_6">1.6</label><br>
      <input type="checkbox" id="module_2" name="module" value="2" checked>
      <label for="module_2">2</label><br>
      <input type="checkbox" id="module_3" name="module" value="3" checked>
      <label for="module_3">3</label><br>
      <input type="checkbox" id="module_36" name="module" value="3.6" checked>
      <label for="module_3_6">3.6</label><br>
      <input type="checkbox" id="module_4" name="module" value="4" checked>
      <label for="module_4">4</label><br>
      <input type="checkbox" id="module_46" name="module" value="4.6" checked>
      <label for="module_4_6">4.6</label><br>
      <input type="checkbox" id="module_5" name="module" value="5" checked>
      <label for="module_5">5</label><br>
      <input type="checkbox" id="module_6" name="module" value="6" checked>
      <label for="module_6">6</label><br>
      <input type="checkbox" id="module_7" name="module" value="7" checked>
      <label for="module_7">7</label><br>
      <input type="checkbox" id="module_8" name="module" value="8" checked>
      <label for="module_7">8</label><br>
      <input type="checkbox" id="module_5p" name="module" value="5p" checked>
      <label for="module_5p">5p</label><br>
      <input type="checkbox" id="module_6p" name="module" value="6p" checked>
      <label for="module_6p">6p</label><br>
      <input type="checkbox" id="module_7p" name="module" value="7p" checked>
      <label for="module_7p">7p</label><br>
    </div>

    <input type="button" value="Submit" class="action" onclick="form_data()" >
    <input type="button" value="Close" onclick="google.script.host.close()" />
  </div>
  <div id="inprogress" style="display: none;">
    <p>Please wait ...</p>
  </div>
  <div id="error" style="display: none; color: red;">
  </div>
  <div id="output" style="display: none;">
    <p>Task completed.</p>
    <p><span><a id="workingDirLink"target="_blank">New Google Drive folder with the generated spreadsheets</a></span> <a
        id="workingDirZipLink" target="_blank">(download zip)</a></p>
    <p>A list of created spreadsheets:</p>
    <div id="links"></div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
  </script>
  <script>
    function onInProgress() {
        document.getElementById('input').style.display = 'none';
        document.getElementById('inprogress').style.display = 'block';
    }
    function onSuccess(result) {
        document.getElementById('inprogress').style.display = 'none';
        var div = document.getElementById('output');
        document.getElementById('workingDirLink').href = result["resultDir"];
        let zipLink = document.getElementById('workingDirZipLink');
        if (result["resultDirDownload"]) {
          zipLink.href = result["resultDirDownload"];
        } else {
          zipLink.style.display = 'none';
        }
        document.getElementById('output').style.display = 'block';
        var linksDiv = document.getElementById('links');
        for (let i = 0; i < result["resultFiles"].length; i++) {
          var elem = result["resultFiles"][i];
          p = document.createElement('p');
          a = document.createElement('a');
          a.href =  elem["exportedFile"];
          a.target = "_blank";
          a.innerHTML = elem["sdkVersion"];
          p.appendChild(a);
          linksDiv.appendChild(p);
          linksDiv.appendChild(document.createElement('br'));
        }
        
    }

    function onFailure(error) {
      document.getElementById('inprogress').style.display = 'none';
      var div = document.getElementById('error');
      div.style.display = 'block';
      div.innerHTML = "An error occured during the execution: " + error.message;
    }

    function form_data(){
        var values = {
          "mappingCfgId": $("input[name=cfgId]:checked").val(),
          "sdkVersions": $("input[name=sdk]:checked").map(function() { return $(this).val() }).get(),
          "includedModules": $("input[name=module]:checked").map(function() { return $(this).val() }).get(),
          "excludedModules": $("input[name=module]").map(function() { if ($(this).is(':not(:checked)')) return $(this).val() }).get()
        };
        google.script.run.withSuccessHandler(onSuccess).withFailureHandler(onFailure).initExportCm(values);
        onInProgress();
        // closeIt()
      };
      function closeIt(){
        google.script.host.close()
      };
      
  </script>
</body>

</html>